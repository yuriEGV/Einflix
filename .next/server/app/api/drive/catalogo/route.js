"use strict";(()=>{var e={};e.id=261,e.ids=[261],e.modules={11185:e=>{e.exports=require("mongoose")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},57147:e=>{e.exports=require("fs")},71017:e=>{e.exports=require("path")},20583:(e,t,o)=>{o.r(t),o.d(t,{headerHooks:()=>h,originalPathname:()=>x,requestAsyncStorage:()=>u,routeModule:()=>d,serverHooks:()=>f,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>g});var i={};o.r(i),o.d(i,{GET:()=>GET,dynamic:()=>c}),o(78976);var a=o(10884),r=o(16132);o(95798);var s=o(57147),l=o(71017),n=o(23858);let c="force-dynamic",p=process.env.JWT_SECRET||"einflix_super_secret_key_2024";async function GET(e){try{let t=e.cookies.get("session_token")?.value,i="none";if(t)try{let e=new TextEncoder().encode(p),{payload:a}=await (0,n._)(t,e),r=(await Promise.all([o.e(764),o.e(409)]).then(o.bind(o,71409))).default,s=(await o.e(258).then(o.bind(o,38258))).default;if(await s(),a.id&&"string"==typeof a.id&&a.id.match(/^[0-9a-fA-F]{24}$/)){let e=await r.findById(a.id);e?(console.log(`CATALOG CHECK: User Found: ${e.email}, Plan: ${e.planType}, Paid: ${e.isPaid}`),e.isPaid?i=e.planType||"basic":console.log(`CATALOG CHECK: User ${e.email} IS NOT PAID.`)):console.log("CATALOG CHECK: User not found in DB")}else console.error("Invalid ID in token payload:",a.id)}catch(e){console.error("Token verification failed in catalog:",e)}let a=l.join(process.cwd(),"data"),r=[];console.log(`CATALOG FILTER: Effective Plan: ${i}`),r="total"===i?["peliculas.txt","series.txt","comics.txt","musica.txt","karaoke.txt","libros.txt","otros.txt"]:"medium"===i?["peliculas.txt","series.txt"]:"basic"===i?["libros.txt"]:[],console.log(`CATALOG FILTER: Allowed Files: ${JSON.stringify(r)}`);let c=[];for(let[e,t]of Object.entries({"peliculas.txt":"Pel\xedcula","series.txt":"Serie","comics.txt":"Comic","musica.txt":"M\xfasica","karaoke.txt":"Karaoke","libros.txt":"Libro","otros.txt":"Otros"})){if(!r.includes(e))continue;let o=l.join(a,e);if(s.existsSync(o)){let e=s.readFileSync(o,"utf8"),i=e.split("\n").filter(e=>e.trim()),a=i.map(e=>{let o=e.split("|").map(e=>e.trim()),i=o[0]||"",a=i.match(/[-\w]{25,}/),r=a?a[0]:null;return r?{id:r,title:o[1]||`Contenido ${r.slice(0,6)}`,tags:o[2]?[o[2]]:[t],cover:o[3]||null,description:o[4]||"Sin descripci\xf3n disponible.",folderUrl:i}:null}).filter(Boolean);c=c.concat(a)}}0===c.length&&console.log("CATALOG: No items found for the current plan.");let d={pelicula:"https://images.unsplash.com/photo-1485846234645-a62644f84728?w=800&q=80",serie:"https://images.unsplash.com/photo-1522869635100-9f4c5e86aa37?w=800&q=80",anime:"https://images.unsplash.com/photo-1578632738980-433120152918?w=800&q=80",novedades:"https://images.unsplash.com/photo-1536440136628-849c177e76a1?w=800&q=80",maratón:"https://images.unsplash.com/photo-1517604931442-7e0c8ed2963c?w=800&q=80",favoritos:"https://images.unsplash.com/photo-1478720568477-152d9b164e26?w=800&q=80",colección:"https://images.unsplash.com/photo-1461360370896-922624d12aa1?w=800&q=80",streaming:"https://images.unsplash.com/photo-1593784991095-a205069470b6?w=800&q=80",premium:"https://images.unsplash.com/photo-1550745165-9bc0b25272a7?w=800&q=80",biblioteca:"https://images.unsplash.com/photo-1507014498014-97050e8902f2?w=800&q=80",galería:"https://images.unsplash.com/photo-1492037766660-2a56f9eb3fcb?w=800&q=80",einflix:"https://images.unsplash.com/photo-1574375927938-d5a98e8ffe85?w=800&q=80"},u=c.map(e=>{let t=e.id;if(!t)return null;let o=!e.folderUrl||e.folderUrl.includes("/folders/"),i=e.tags||[],a=i[0]||(o?"Carpeta":"Multimedia");a=a.charAt(0).toUpperCase()+a.slice(1);let r=e.cover||`/api/drive/thumbnail?id=${t}`;if(r.includes("drive.google.com/thumbnail")){let e=i.map(e=>e.toLowerCase());for(let[t,o]of Object.entries(d))if(e.includes(t)){r=o;break}}return{id:t,title:e.title||`Contenido ${t.slice(0,6)}`,category:a,description:e.description||"Sin descripci\xf3n disponible.",type:o?"folder":"video",original:o?`https://drive.google.com/embeddedfolderview?id=${t}#grid`:e.folderUrl||`https://drive.google.com/file/d/${t}/view`,preview:o?`https://drive.google.com/embeddedfolderview?id=${t}#grid`:`https://drive.google.com/file/d/${t}/preview`,thumbnail:r}}).filter(Boolean),m=new Set;return(u=u.filter(e=>{let t=m.has(e.id);return m.add(e.id),!t})).sort((e,t)=>e.title.localeCompare(t.title)),new Response(JSON.stringify(u),{headers:{"Content-Type":"application/json"}})}catch(e){return console.error("Error en la API de Catalogo:",e),new Response(JSON.stringify({error:"Error interno del servidor"}),{status:500,headers:{"Content-Type":"application/json"}})}}let d=new a.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/drive/catalogo/route",pathname:"/api/drive/catalogo",filename:"route",bundlePath:"app/api/drive/catalogo/route"},resolvedPagePath:"C:\\einflix\\app\\api\\drive\\catalogo\\route.js",nextConfigOutput:"",userland:i}),{requestAsyncStorage:u,staticGenerationAsyncStorage:m,serverHooks:f,headerHooks:h,staticGenerationBailout:g}=d,x="/api/drive/catalogo/route"}};var t=require("../../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),o=t.X(0,[364,935,798,858],()=>__webpack_exec__(20583));module.exports=o})();
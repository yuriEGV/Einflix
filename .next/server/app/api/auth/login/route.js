"use strict";(()=>{var e={};e.id=873,e.ids=[873],e.modules={11185:e=>{e.exports=require("mongoose")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},42634:(e,o,r)=>{r.r(o),r.d(o,{headerHooks:()=>g,originalPathname:()=>_,requestAsyncStorage:()=>l,routeModule:()=>c,serverHooks:()=>m,staticGenerationAsyncStorage:()=>d,staticGenerationBailout:()=>x});var t={};r.r(t),r.d(t,{POST:()=>POST}),r(78976);var a=r(10884),s=r(16132),n=r(57030),i=r(38258),u=r(71409);let p=process.env.JWT_SECRET||"einflix_super_secret_key_2024";function jsonResponse(e,o=200,r={}){return new Response(JSON.stringify(e),{status:o,headers:{"Content-Type":"application/json",...r}})}async function POST(e){console.log("=== LOGIN REQUEST ===");try{let o;await (0,i.default)();try{o=await e.json()}catch(e){throw console.error("Error parsing body:",e),Error("Invalid XML/JSON body")}let{email:r,password:t}=o,a=await u.default.findOne({email:r.toLowerCase()});if(a&&await a.comparePassword(t)){let e=new TextEncoder().encode(p),o=await new n.N({email:a.email,id:a._id,name:a.name,isPaid:a.isPaid||!1}).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime("3h").sign(e),r=jsonResponse({success:!0,message:"Login exitoso",user:{name:a.name,email:a.email}}),t=`session_token=${o}; Path=/; Max-Age=10800; HttpOnly; SameSite=Lax; Secure`;return r.headers.append("Set-Cookie",t),r}return jsonResponse({success:!1,message:"Correo o contrase\xf1a incorrectos"},401)}catch(e){return console.error("Login Error:",e),jsonResponse({success:!1,message:"Error interno del servidor: "+e.message},500)}}let c=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"C:\\einflix\\app\\api\\auth\\login\\route.js",nextConfigOutput:"",userland:t}),{requestAsyncStorage:l,staticGenerationAsyncStorage:d,serverHooks:m,headerHooks:g,staticGenerationBailout:x}=c,_="/api/auth/login/route"}};var o=require("../../../../webpack-runtime.js");o.C(e);var __webpack_exec__=e=>o(o.s=e),r=o.X(0,[364,764,935,30,258,409],()=>__webpack_exec__(42634));module.exports=r})();
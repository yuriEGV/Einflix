"use strict";(()=>{var e={};e.id=2,e.ids=[2],e.modules={11185:e=>{e.exports=require("mongoose")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},32081:e=>{e.exports=require("child_process")},6113:e=>{e.exports=require("crypto")},9523:e=>{e.exports=require("dns")},82361:e=>{e.exports=require("events")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},41808:e=>{e.exports=require("net")},22037:e=>{e.exports=require("os")},71017:e=>{e.exports=require("path")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},20350:(e,r,s)=>{s.r(r),s.d(r,{headerHooks:()=>g,originalPathname:()=>x,requestAsyncStorage:()=>u,routeModule:()=>p,serverHooks:()=>d,staticGenerationAsyncStorage:()=>c,staticGenerationBailout:()=>m});var t={};s.r(t),s.d(t,{POST:()=>POST}),s(78976);var o=s(10884),i=s(16132),a=s(38258),n=s(71409),l=s(57030);function jsonResponse(e,r=200){return new Response(JSON.stringify(e),{status:r,headers:{"Content-Type":"application/json"}})}async function POST(e){console.log("=== REGISTER REQUEST ===");try{let r;await (0,a.default)();try{r=await e.json()}catch(e){throw console.error("Error parsing body:",e),Error("Invalid XML/JSON body")}let{name:t,email:o,password:i,planType:p}=r;console.log("Registering:",o,"Plan:",p);let u=await n.default.findOne({email:o.toLowerCase()});if(u)return jsonResponse({success:!1,message:"El correo ya est\xe1 registrado"},400);console.log("Importing bcrypt...");let c=await Promise.resolve().then(s.bind(s,45764)),d=c.default||c;console.log("Hashing password...");let g=await d.genSalt(10),m=await d.hash(i,g),x=await n.default.create({name:t,email:o,password:m,planType:p||"basic"});console.log("User created:",x._id);let E=new TextEncoder().encode(process.env.JWT_SECRET||"einflix_super_secret_key_2024"),h=await new l.N({email:x.email,id:x._id.toString(),name:x.name,isPaid:!1}).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime("3h").sign(E),S=jsonResponse({success:!0,message:"Usuario registrado con \xe9xito",user:{id:x._id,name:x.name,email:x.email}}),f=`session_token=${h}; Path=/; Max-Age=10800; HttpOnly; SameSite=Lax; Secure`;S.headers.append("Set-Cookie",f);try{console.log("Configuring email transporter...");let e=await s.e(709).then(s.t.bind(s,66709,19)),r=e.createTransport({service:"gmail",auth:{user:process.env.EMAIL_USER,pass:process.env.EMAIL_PASS}}),i={from:process.env.EMAIL_USER,to:o,subject:"\xa1Bienvenido a Einflix!",html:`
                    <div style="font-family: Arial, sans-serif; color: #333;">
                        <h1 style="color: #E50914;">Bienvenido a Einflix</h1>
                        <p>Hola <strong>${t}</strong>,</p>
                        <p>Gracias por registrarte en nuestra plataforma.</p>
                        <p>Tus credenciales de acceso son:</p>
                        <ul>
                            <li><strong>Email:</strong> ${o}</li>
                            <li><strong>Contrase\xf1a:</strong> (La que definiste al registrarte)</li>
                        </ul>
                        <p>Disfruta del mejor contenido en streaming.</p>
                        <br>
                        <p>Atentamente,<br>El equipo de Einflix</p>
                    </div>
                `};process.env.EMAIL_USER&&process.env.EMAIL_PASS?(console.log("Sending welcome email..."),r.sendMail(i).catch(e=>console.error("Email send async fail:",e)),console.log("Email queued.")):console.log("Skipping email: EMAIL_USER or EMAIL_PASS not set in .env")}catch(e){console.error("Error sending email:",e)}return S}catch(e){return console.error("Register Error:",e),jsonResponse({success:!1,message:"Error al registrar usuario: "+e.message},500)}}let p=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/auth/register/route",pathname:"/api/auth/register",filename:"route",bundlePath:"app/api/auth/register/route"},resolvedPagePath:"C:\\einflix\\app\\api\\auth\\register\\route.js",nextConfigOutput:"",userland:t}),{requestAsyncStorage:u,staticGenerationAsyncStorage:c,serverHooks:d,headerHooks:g,staticGenerationBailout:m}=p,x="/api/auth/register/route"}};var r=require("../../../../webpack-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),s=r.X(0,[364,764,935,30,258,409],()=>__webpack_exec__(20350));module.exports=s})();